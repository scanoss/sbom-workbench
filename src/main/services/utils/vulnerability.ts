import { NewComponentDTO } from '@api/types';
import log from 'electron-log';
import { AddVulnerabilityTask } from '../../task/vulnerability/AddVulnerabilityTask';

export async function AddVulnerability(data: NewComponentDTO) {
  try {
    // If everything goes right

    log.info('%c[ Vulnerability ]: Importing vulnerability into database', 'color: green');
    // Adds component's vulnerabilities
    const addVulnerability = new AddVulnerabilityTask();
    await addVulnerability.run(adaptToVulnerabilityTask(data));
  } catch (e: any) {
    throw new Error(e);
  }
}

function adaptToVulnerabilityTask(component: NewComponentDTO): Array<string> {
  const response = component.versions.map(
    (v) => `${component.purl}@${v.version}`,
  );
  return response;
}
