import { VulnerabilitiesGetAllDTO } from '@api/dto';
import { ipcMain } from 'electron';
import log from 'electron-log';
import { vulnerabilityService } from '../../main/services/VulnerabilityService';
import { IpcChannels } from '../ipc-channels';
import { Response } from '../Response';

ipcMain.handle(IpcChannels.VULNERABILITY_GET_ALL, async (event, { type }: VulnerabilitiesGetAllDTO) => {
  try {
    const vulnerabilities = await vulnerabilityService.getAll(type);
    return Response.ok({ message: 'Vulnerabilities fetched successfully', data: vulnerabilities });
  } catch (error: any) {
    log.error('[ Vulnerability get all ]: ', error);
    return Response.fail({ message: error.message });
  }
});

ipcMain.handle(IpcChannels.VULNERABILITY_UPDATE, async (event) => {
  try {
    const data = await vulnerabilityService.update();
    return Response.ok({ message: 'Vulnerabilities updated successfully', data });
  } catch (error: any) {
    log.error('[ Vulnerability update ]: ', error);
    return Response.fail({ message: error.message });
  }
});
